[Previous](/docs/page00013.md) | [Next](/docs/page00015.md)

# Testing the API Endpoints

With the database connected, the crucial next step is to test the API to ensure it can correctly create and retrieve records. We can do this using a command-line tool like `curl`.

The testing process follows a logical sequence:
1.  Add data to the database using the `POST` endpoint.
2.  Retrieve that data using the `GET` endpoints.

## 1. Testing the Ingestion Endpoint (`POST /api/v1/readings`)

To add a new reading to the database, we send a `POST` request with a JSON payload containing the sensor data. The field names in the JSON must exactly match those expected by the API's Pydantic model (`ReadingCreate`).

```bash
curl -X POST "http://127.0.0.1:8000/api/v1/readings" \
-H "Content-Type: application/json" \
-d '{
    "timestamp": "2025-11-30T08:15:00Z",
    "plant_id": "basil_plant_01",
    "lettuce_image_url": "http://example.com/images/lettuce.jpg",
    "ec": 1200,
    "ph": 6.5,
    "temp_c": 21.5,
    "n_ppm": 1.2,
    "p_ppm": 0.8,
    "k_ppm": 1.5
}'
```

This request will succeed, and the data will be saved to the `readings` table in the database.

## 2. Testing the Read Endpoints

Once data has been successfully posted, we can test the `GET` endpoints.

### Get Latest Reading

```bash
curl "http://127.0.0.1:8000/api/v1/readings/latest"
```

This should return a JSON object for the single most recent reading you just posted.

### Get History

```bash
curl "http://127.0.0.1:8000/api/v1/readings/history?period=7d"
```

This should return a JSON array containing all the readings you have posted so far that fall within the last 7 days.

## 3. Understanding the Data Payload

The JSON payload sent to the `POST` endpoint and returned by the `GET` endpoints represents a single snapshot of environmental and nutritional data for a specific plant.

### Example Payload

```json
{
    "timestamp": "2025-11-30T08:15:00Z",
    "plant_id": "lettuce_plant_01",
    "lettuce_image_url": "http://example.com/images/lettuce.jpg",
    "ec": 1200,
    "ph": 6.5,
    "temp_c": 21.5,
    "n_ppm": 1.2,
    "p_ppm": 0.8,
    "k_ppm": 1.5
}
```

### Field Descriptions

*   **`timestamp`**: The exact UTC date and time when the sensor readings were taken.
*   **`plant_id`**: A unique identifier for the plant being monitored.
*   **`lettuce_image_url`**: A URL to an image of the plant, used for visual inspection or analysis.
*   **`ec`**: **Electrical Conductivity**. A measure of the total dissolved nutrients in the water, likely in microsiemens per centimeter (µS/cm).
*   **`ph`**: The acidity or alkalinity of the water. A pH of 6.5 is slightly acidic, which is ideal for nutrient absorption for many plants.
*   **`temp_c`**: The temperature of the water or ambient air in degrees Celsius (°C).
*   **`n_ppm`**, **`p_ppm`**, **`k_ppm`**: The concentration of the primary macronutrients—**N**itrogen, **P**hosphorus, and **K**alium (Potassium)—measured in parts per million (ppm). These are vital for plant health.

## 4. Understanding the Latest Reading Response

While the `POST` request sends raw data, the response from the `GET /api/v1/readings/latest` endpoint is a richer, nested JSON object. The server takes the latest database record, processes it, and combines it with predictions and status information.

### Example Response

```json
{
	"timestamp": "2025-11-30T16:15:00",
	"plant_id": "lettuce_plant_01",
	"lettuce_image_url": "http://example.com/images/lettuce.jpg",
	"sensors": {
		"ec": 1200,
		"ph": 6.5,
		"temp_c": 21.5
	},
	"predictions": {
		"n_ppm": 1.2,
		"p_ppm": 0.8,
		"k_ppm": 1.5
	},
	"status": {
		"n_status": "low",
		"p_status": "low",
		"k_status": "low",
		"overall_status": "warning"
	},
	"recommendation": "Check nutrient levels."
}
```

### Field Descriptions

This response is structured using nested Pydantic models, as documented in `page00002.md` and `page00003.md`.

*   **`timestamp`**, **`plant_id`**, **`lettuce_image_url`**: Top-level identifiers for the reading.
*   **`sensors` (Object)**: Contains the raw data directly from the physical sensors, corresponding to the `SensorData` model.
*   **`predictions` (Object)**: Contains the output from the machine learning model, predicting nutrient levels based on the sensor data. This corresponds to the `PredictionData` model.
*   **`status` (Object)**: Provides a simple, human-readable status (`low`, `ok`, `high`) for each nutrient and an `overall_status` for the system. This is generated by the API based on predefined thresholds.
*   **`recommendation` (String)**: An actionable text suggestion for the user based on the overall status of the system.

Previous | Next